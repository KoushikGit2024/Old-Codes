#include<stdio.h>
#include<conio.h>
#include<stdlib.h>
//structure for service delivery 
struct emply{
    char emp_id[4];
    char emp_name[10];
    int basic;
    struct emply *next;
};
struct emply *head[6]={NULL,NULL,NULL,NULL,NULL,NULL},*crnt;
//head for department || crnt=current record 
//0,1,2,3,4 posn of head represent Administration, Financial, Production, Service Delivery, Business Development
char pw[4]="u123",pwch[4],tempname[10],tempid[4];
int dpmt,tempbs,idrank=0;
void main_menu();
int sub_menu();
void sec_check();
void insert();
void delete();
void dspl();
int dspl_opt();
void pntRcrdAll(struct emply *now);
void pntRcrdStd(struct emply *now,field[11]);
void main1();
void main()
{
    main1();
    /*dpmt=3;
    insert();
    //insert();
    //insert();
    //delete();
    /*
    printf("\n|ID\t|Name\t\t|BASIC\t|DA\t|TA\t|HRA\t|SPLNC\t|ESI\t|PF\t|NET\t|");
    printf("\n=========================================================================================");
    printf("\n-----------------------------------------------------------------------------------------");
    printf("\n|ajaj\t|jkssks\t\ty486798");*/
}

void main1()
{
    int i;
    char a, b;
    printf("\n{Welcome to Technoxy}");
    sec_check();
    main_menu();
}
void main_menu()
{
    int opt,rpt;
    start:
    printf("\n#Which department do you want to visit:\n");
    printf("1)Administration\t2)Financial\n3)Production\t\t4)Service Delivery\n5)Business Development\t6)Exit");
    do{
    printf("\nEnter the option: ");
    scanf("%d",&opt);
    dpmt=opt;
    switch(opt)
    {
        case 1:
            printf("\n Administration Department");
            printf("\n===========================");
        break;
        case 2:
            printf("\n Financial Department");
            printf("\n======================");
        break;
        case 3:
            printf("\n Production Department");
            printf("\n=======================");
        break;
        case 4:
            printf("\n Service Delivery Department");
            printf("\n=============================");
        break;
        case 5:
            printf("\n Business Development Department");
            printf("\n=================================");
        break;
        case 6:
            exit(0);
        break;    
        default:
            printf("\n(The number is out of range!!)");
    }
    }while (opt<1||opt>6);
    rpt=sub_menu();
    if(rpt==4)
        goto start;
}
int sub_menu()
{
    int opt;
    printf("\nWhat does you want?");
    printf("\n1)Insert Record\t2)Delete Record\n3)Display\t4)Goto Main Menu");
    do{
    printf("\nEnter the option: ");
    scanf("%d",&opt);
    switch(opt)
    {
        case 1:
            insert();
        break;
        case 2:
            delete();
        break;
        case 3:
            dspl();
        break;
        case 4:
            clrscr();
            goto last;
        break;
        default:
            printf("\n(The number is out of range!!)");
    }
    }while(opt>4||opt<1);
    last:
    clrscr();
    if(opt==4)
        return 4;
    else
        return 0;    
}
void sec_check()//Security Cheching
{
    int tempw1,tempw2=3;
    do{
    printf("\nEnter authority password:");
    scanf("%s",&pwch);
    tempw1=strcmp(pw, pwch);
    if(tempw1==0)
        printf("\n(Welcome Sir)");
    else
    {
        tempw2--;
        if(tempw2==0)
        {
            printf("\n(Request terminated)\n(Server shut downed)");
            getch();
            getch();
            exit(0);        
        }
        printf("\nThe password is incorrect!!!");
        printf("\nYou have only %d more chance",tempw2);
    }
    }while(tempw1!=0);
}
void insert()
{
    int i;
    if(head[dpmt]==NULL)
    {
        head[dpmt]=(struct emply*) malloc (sizeof(struct emply));
        crnt=head[dpmt];
        i=0;
    }
    else
    {
        crnt=head[dpmt];
        for(i=0;crnt->next!=NULL;i++)
        {
            crnt=crnt->next;
        }
        crnt->next=(struct emply*) malloc (sizeof(struct emply));
        crnt=crnt->next;
    }
    idrank++;
    tempid[3]=(char)(48+idrank);
    tempid[0]='t';
    printf("\nEnter your name(10 char): ");
    scanf("%s",tempname);
    strcpy(crnt->emp_name,tempname);
    printf("\nEnter your basic: ");
    scanf("%d",&tempbs);
    crnt->basic=tempbs;
    if(dpmt==1)
    {
        tempid[1]='a';
        tempid[2]='d';
    }
    else if(dpmt==2)
    {
        tempid[1]='f';
        tempid[2]='n';
    }
    else if(dpmt==3)
    {
        tempid[1]='p';
        tempid[2]='d';
    }
    else if(dpmt==4)
    {
        tempid[1]='s';
        tempid[2]='d';
    }
    else if(dpmt==5)
    {
        tempid[1]='b';
        tempid[2]='d';
    }
    strcpy(crnt->emp_id,tempid);
    crnt->next=NULL;
    printf("\n(Record excepted)\nYour generated ID is : ");
    for(i=0;i<4;i++)
        printf("%c",tempid[i]);
    getch();
    getch();
    clrscr();
}
void delete()
{
    char temid[4],alpha[4],a[4];
    int i,chk;
    struct emply *temp;
    printf("\nEnter the ID of lthe employee which should be deleted: ");
    scanf("%s",&temid);
    for(i=0;i<4;i++)
        alpha[i]=crnt->emp_id[i];
    strcpy(alpha,crnt->emp_id);
    strcpy(a,alpha);
    crnt=head[dpmt];
    temp=crnt;
    for(;crnt->next!=NULL&&chk!=0;crnt=crnt->next)
    {
        chk=strcmp(alpha,crnt->emp_id);
        if(chk!=0)
            temp=crnt;
    }
    if(chk==0)
    {
        int opt;
        printf("\nRecord found!Do you really want to delete it?");
        printf("\n1)Yes\t2)No");
        do{
            printf("\nEnter the no. ");
            scanf("%d",&opt);
            if(opt>2||opt<1)
                printf("(The number is invalid)");
        }while(opt>2||opt<1);
        if(opt==1)
        {
            temp->next=crnt->next;
            free(crnt);
            printf("\n(Record deleted successfully)");
        }
    }
    //printf("%s,%s,%s",temid,alpha,a);
}
int dspl_opt()//Option about display
{
    int opt1,opt2;
    if(head[dpmt]==NULL)
    {
        printf("\n(No record is available in this department)");
        return 0;
    }
    else
    {
    printf("\nDisplay:-");
    printf("\n1)Only one record\t2)All record");
    do{
    printf("\Enter the number: ");
    scanf("%d",&opt1);
    if(opt1<1||opt1>2)
        printf("\n(The number is invalid)");
    } while (opt1<1||opt1>2);
    printf("\n1)Selected field\t2)All field");
    do{
    printf("\nEnter the number: ");
    scanf("%d",&opt2);
    if(opt2<1||opt2>2)
        printf("\n(The number is invalid)");
    else
    {
        if(opt2==1)
            opt2=4;
        else
            opt2=6;    
    }
    } while (opt2!=4&&opt2!=6);
    return (opt1+opt2);
    }
}
void dspl()
{
    int i=0,j,tempd=0,opt,type,selfld[11];
    type=dspl_opt();
    if(type!=0)
    {
        if(type==8)
        {
            crnt=head[dpmt];
            printf("\nThe records are: ");
            printf("\n|ID\t|Name\t\t|BASIC\t|DA\t|TA\t|HRA\t|SPLNC\t|GROSD\t|ESI\t|PF\t|TAX\t|NET\t|");
            printf("\n=========================================================================================");
            for(i=0;crnt->next!=NULL;i++);
            tempd=i+1;
            for(i=0;i<tempd;i++)
            {
                pntRcrdAll(crnt);
                printf("\n-----------------------------------------------------------------------------------------");
                crnt=crnt->next;
            }
        }
        else if(type==7)
        {
            char temid[4],alpha[4];
            int flag=0,chk;
            printf("\nEnter the employee ID: ");
            scanf("%s",&temid);
            for(i=0;i<4;i++)
                alpha[i]=crnt->emp_id[i];
            chk=strcmp(temid,alpha);    
            for(;chk!=0&&crnt->next!=NULL;crnt=crnt->next)
            {
                for(i=0;i<4;i++)
                    alpha[i]=crnt->emp_id[i];
                chk=strcmp(temid,alpha);   
            }
            //printf("%d %s %s %s",chk,temid,crnt->emp_id,alpha);
            if(chk==0)
            {
                flag=1;
                //printf("xigdjsjfsjgjsi");
            }   
            if(flag!=1)
            {
                printf("\n(The given ID is not found or it is incorrect please try again)");
            }
            else
            {
                printf("\nThe record is: ");
                printf("\n|ID\t|Name\t\t|BASIC\t|DA\t|TA\t|HRA\t|SPLNC\t|GROSS\t|ESI\t|PF\t|TAX\t|NET\t|");
                printf("\n=========================================================================================");
                pntRcrdAll(crnt);
            }
        }
        else if(type==6)
        {
            int dash=1;
            for(i=0;i<10;i++)
            {
                if(i==0)
                    printf("\nDo you want Name?");
                else if(i==1)
                    printf("\nDo you want Basic?");
                else if(i==2)
                    printf("\nDo you want DA?");
                else if(i==3)
                    printf("\nDo you want TA?");
                else if(i==4)
                    printf("\nDo you want HRA?");
                else if(i==5)
                    printf("\nDo you want Special Allowance?");
                else if(i==6)
                    printf("\nDo you want ESI?");
                else if(i==7)
                    printf("\nDo you want PF?");
                else if(i==8)
                     printf("\nDo you want Tax?");
                else if(i==9)
                     printf("\nDo you want Net?");    
                printf("\n1)Yes\t2)No");
                do{
                        printf("\nEnter the no. ");
                        scanf("%d",opt);
                        selfld[i]=0;
                        if(opt>2||opt<1)
                            printf("(The number is invalid)");
                        else if(opt==1)
                            selfld[i]=1;
                }while(opt>2||opt<1);
            }
            for(i=1;i<11;i++)
            selfld[i]=i%2;
            printf("\nThe records are: ");
            printf("\n|ID");
            if(selfld[1]==1)
            {
                printf("\t|BASIC");
                dash++;
            }    
            if(selfld[2]==1)
            {
                printf("\t|DA");
                dash++;
            }   
            if(selfld[3]==1)
            {
                printf("\t|TA");
                dash++;
            }    
            if(selfld[4]==1)
            {
                printf("\t|HRA");
                dash++;
            }
            if(selfld[5]==1)
            {
                printf("\t|SPLNC");
                dash++;
            }
            if(selfld[6]==1)
            {
                printf("\t|GROSS");
                dash++;
            }
            if(selfld[7]==1)
            {
                printf("\t|ESI");
                dash++;
            }
            if(selfld[8]==1)
            {
                printf("\t|PF");
                dash++;
            }
            if(selfld[9]==1)
            {
                printf("\t|TAX");
                dash++;
            }
            if(selfld[10]==1)
            {
                printf("\t|NET");
                dash++;
            }
            printf("\t|\n");
            for(i=0;i<dash;i++)
                printf("========");
            crnt=head[dpmt];
            for(i=0;crnt->next!=NULL;i++);
            tempd=i+1;
            for(i=0;i<tempd;i++)
            {
                pntRcrdStd(crnt,selfld[11]);
            }
        }    
    }
}
void pntRcrdAll(struct emply *now)//Print Record All
{
    int j,bsc,da,ta,hra,splnc,gross,esi,net,pf,tax;
    printf("\n|");
    for(j=0;j<4;j++)
        printf("%c",now->emp_id[j]);
    printf("\t|");    
    for(j=0;j<10;j++)
        printf("%c",now->emp_name[j]); 
    if(now->emp_name[6]==NULL)
        printf("\t");
    bsc=crnt->basic;
    da=bsc*40/100;
    ta=bsc*15/100;
    hra=bsc/5;
    splnc=bsc/5;
    gross=bsc+da+ta+hra+splnc;
    esi=bsc/100;
    if(gross>=30000)
        pf=300;
    else if(gross>=20000)
        pf=200;
    else
        pf=0;
    if(gross>=30000)
        tax=gross*15/100;
    else if(gross>=20000)
        tax=gross*10/100;    
    else if(gross>=20000)
        tax=gross*5/100;
    else
        tax=0;
    net=gross-esi-pf-tax;
    printf("\t|%d\t|%d\t|%d\t|%d\t|%d\t|%d\t|%d\t|%d\t|%d\t|%d\t|",bsc,da,ta,hra,splnc,gross,esi,pf,tax,net); 
    printf("\n-----------------------------------------------------------------------------------------");
}
void pntRcrdStd(struct emply *now,field[11])//Print Record Seleted
{
    int j,bsc,da,ta,hra,splnc,gross,esi,net,pf,tax,dash=1;
    printf("\n|");
    for(j=0;j<4;j++)
        printf("%c",now->emp_id[j]);
    if(field[0]==1)
    {
    printf("\t|");    
    for(j=0;j<10;j++)
        printf("%c",now->emp_name[j]); 
    if(now->emp_name[6]==NULL)
        printf("\t");
    dash+=2;    
    }   
    bsc=crnt->basic;
    da=bsc*40/100;
    ta=bsc*15/100;
    hra=bsc/5;
    splnc=bsc/5;
    gross=bsc+da+ta+hra+splnc;
    esi=bsc/100;
    if(gross>=30000)
        pf=300;
    else if(gross>=20000)
        pf=200;
    else
        pf=0;
    if(gross>=30000)
        tax=gross*15/100;
    else if(gross>=20000)
        tax=gross*10/100;    
    else if(gross>=20000)
        tax=gross*5/100;
    else
        tax=0;
    net=gross-esi-pf-tax;
    if(field[1]==1)
    {
        printf("\t|%d",bsc);
        dash++;
    }
    if(field[2]==1)
    {
        printf("\t|%d",da);
        dash++;
    }
    if(field[3]==1)
    {
        printf("\t|%d",ta);
        dash++;
    }
    if(field[4]==1)
    {
        printf("\t|%d",hra);
        dash++;
    }
    if(field[5]==1)
    {
        printf("\t|%d",splnc);
        dash++;
    }
    if(field[6]==1)
    {
        printf("\t|%d",gross);
        dash++;
    }
    if(field[7]==1)
    {
        printf("\t|%d",esi);
        dash++;
    }
    if(field[8]==1)
    {
        printf("\t|%d",pf);
        dash++;
    }
    if(field[9]==1)
    {
        printf("\t|%d",tax);
        dash++;
    }
    if(field[10]==1)
    {
        printf("\t|%d",net);
        dash++;
    }
    printf("\t|\n");
    for(j=0;j<dash;j++)
        printf("-------");
}
/*              printf("\n|");
                for(j=0;j<4;j++)
                    printf("%c",crnt->emp_id[j]);
                printf("\t|");    
                for(j=0;j<10;j++)
                    printf("%c",crnt->emp_name[j]); 
                if(crnt->emp_name[6]==NULL)
                    printf("\t");
                bsc=crnt->basic;
                da=bsc*40/100;
                ta=bsc*15/100;
                hra=bsc/5;
                splnc=bsc/5;
                gross=bsc+da+ta+hra+splnc;
                esi=bsc/100;
                if(gross>=30000)
                    pf=300;
                else if(gross>=20000)
                    pf=200;
                else
                    pf=0;
                if(gross>=30000)
                    tax=gross*15/100;
                else if(gross>=20000)
                    tax=gross*10/100;    
                else if(gross>=20000)
                    tax=gross*5/100;
                else
                    tax=0;
                net=gross-esi-pf-tax;
                printf("\t|%d\t|%d\t|%d\t|%d\t|%d\t|%d\t|%d\t|%d\t|",bsc,da,ta,hra,splnc,esi,pf,net);
*/                